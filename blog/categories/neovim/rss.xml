<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>neovim | Matthew Daly&apos;s Blog</title>
        <link>https://matthewdaly.co.uk/blog/categories/neovim/</link>
        <description>neovim | I&apos;m a web developer in Norfolk. This is my blog...</description>
        <lastBuildDate>Sun, 18 Nov 2018 22:15:58 GMT</lastBuildDate>
        <docs>http://blogs.law.harvard.edu/tech/rss</docs>
        <generator>grunt-blogbuilder https://github.com/matthewbdaly/grunt-blogbuilder</generator>
        <copyright>Matthew Daly 2018</copyright>
        <item>
            <title><![CDATA[Switching from Vim to Neovim]]></title>
            <link>https://matthewdaly.co.uk/blog/2018/09/09/switching-from-vim-to-neovim/</link>
            <guid>https://matthewdaly.co.uk/blog/2018/09/09/switching-from-vim-to-neovim/</guid>
            <pubDate>Sun, 09 Sep 2018 12:40:35 GMT</pubDate>
            <description><![CDATA[<p>I honestly thought it would never happen. I’ve been using Vim since 2008, and every other editor I’ve tried (including VSCode, Emacs, Sublime Text and Atom) hasn’t come up to scratch. There were a few useful features in PHPStorm, to be fair, but nothing that justified the bother of moving. Also, I suffer from a degree of RSI from my prior career as an insurance clerk (years of using crap keyboards and mice on Windows XP took its toll…), and Vim has always been the most RSI-friendly editor I found.</p>
<p>Yet I have actually gone ahead and migrated away… to Neovim. Of course, the fact that the workflow is essentially identical helps in the migration process, as does the fact that it supports most of the same plugins.</p>
<p>My workflow has always been strongly CLI-based. I use GNU Screen and Byobu together to run multiple “tabs” in the terminal, so the lack of GUI support in Neovim doesn’t bother me in the slightest. The only change I really made was to my <code>.bash_aliases</code> so that the Vim command ran <code>screen -t Vim nvim</code>, so that it would open up Neovim rather than Vim in a new Screen tab.</p>
<p>Initially I switched straight over to using the same settings and plugins I had with Vim, and they worked seamlessly. However, after a while I decided to use the opportunity to completely overhaul the plugins and settings I used and largely start over - cull the ones I no longer needed, add some new ones, and comment it properly.</p>
<h2 id="loading-plugins">Loading plugins</h2>
<p>I used to use Pathogen to manage my Vim plugins, but it didn’t actually import the plugins itself, and just provided a structure for them. This meant that the only practical way I found to pull in third-party plugins was to set them up as Git submodules, meaning I had to store my configuration in version control and clone it recursively onto a new machine. It also made updating cumbersome.</p>
<p>Now I’ve switched to <a href="https://github.com/junegunn/vim-plug">vim-plug</a>, which makes things much easier. I can define my dependencies in my <code>.config/nvim/init.vim</code> and pull them in with <code>PlugInstall</code>. If I want to update them, I run <code>PlugUpdate</code>, or if I need to add something else, I merely add it in the file and run <code>PlugInstall</code> again. Nice and easy.</p>
<p>The first section of my configuration file loads the dependencies:</p>
<pre><code class="hljs lang-vim"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-keyword">call</span> plug#begin()</td><tr><td class="linenos" data-pseudo-content="2"></td><td></td><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-comment">" NERDTree</span></td><tr><td class="linenos" data-pseudo-content="4"></td><td>Plug <span class="hljs-string">'scrooloose/nerdtree'</span></td><tr><td class="linenos" data-pseudo-content="5"></td><td></td><tr><td class="linenos" data-pseudo-content="6"></td><td><span class="hljs-comment">" Git integration</span></td><tr><td class="linenos" data-pseudo-content="7"></td><td>Plug <span class="hljs-string">'tpope/vim-fugitive'</span></td><tr><td class="linenos" data-pseudo-content="8"></td><td>Plug <span class="hljs-string">'airblade/vim-gitgutter'</span></td><tr><td class="linenos" data-pseudo-content="9"></td><td></td><tr><td class="linenos" data-pseudo-content="10"></td><td><span class="hljs-comment">" Linting</span></td><tr><td class="linenos" data-pseudo-content="11"></td><td>Plug <span class="hljs-string">'neomake/neomake'</span></td><tr><td class="linenos" data-pseudo-content="12"></td><td>Plug <span class="hljs-string">'w0rp/ale'</span></td><tr><td class="linenos" data-pseudo-content="13"></td><td></td><tr><td class="linenos" data-pseudo-content="14"></td><td><span class="hljs-comment">" PHP-specific integration</span></td><tr><td class="linenos" data-pseudo-content="15"></td><td>Plug <span class="hljs-string">'phpactor/phpactor'</span> ,  {<span class="hljs-string">'do'</span>: <span class="hljs-string">'composer install'</span>, <span class="hljs-string">'for'</span>: <span class="hljs-string">'php'</span>}</td><tr><td class="linenos" data-pseudo-content="16"></td><td>Plug <span class="hljs-string">'ncm2/ncm2'</span></td><tr><td class="linenos" data-pseudo-content="17"></td><td>Plug <span class="hljs-string">'roxma/nvim-yarp'</span></td><tr><td class="linenos" data-pseudo-content="18"></td><td>Plug <span class="hljs-string">'phpactor/ncm2-phpactor'</span></td><tr><td class="linenos" data-pseudo-content="19"></td><td></td><tr><td class="linenos" data-pseudo-content="20"></td><td><span class="hljs-comment">" Snippets</span></td><tr><td class="linenos" data-pseudo-content="21"></td><td>Plug <span class="hljs-string">'SirVer/ultisnips'</span></td><tr><td class="linenos" data-pseudo-content="22"></td><td>Plug <span class="hljs-string">'honza/vim-snippets'</span></td><tr><td class="linenos" data-pseudo-content="23"></td><td></td><tr><td class="linenos" data-pseudo-content="24"></td><td><span class="hljs-comment">" Comments</span></td><tr><td class="linenos" data-pseudo-content="25"></td><td>Plug <span class="hljs-string">'tpope/vim-commentary'</span></td><tr><td class="linenos" data-pseudo-content="26"></td><td></td><tr><td class="linenos" data-pseudo-content="27"></td><td><span class="hljs-comment">" Search</span></td><tr><td class="linenos" data-pseudo-content="28"></td><td>Plug <span class="hljs-string">'ctrlpvim/ctrlp.vim'</span></td><tr><td class="linenos" data-pseudo-content="29"></td><td></td><tr><td class="linenos" data-pseudo-content="30"></td><td><span class="hljs-comment">" Syntax</span></td><tr><td class="linenos" data-pseudo-content="31"></td><td>Plug <span class="hljs-string">'sheerun/vim-polyglot'</span></td><tr><td class="linenos" data-pseudo-content="32"></td><td>Plug <span class="hljs-string">'matthewbdaly/vim-filetype-settings'</span></td><tr><td class="linenos" data-pseudo-content="33"></td><td></td><tr><td class="linenos" data-pseudo-content="34"></td><td><span class="hljs-comment">" Themes</span></td><tr><td class="linenos" data-pseudo-content="35"></td><td>Plug <span class="hljs-string">'nanotech/jellybeans.vim'</span> , {<span class="hljs-string">'as'</span>: <span class="hljs-string">'jellybeans'</span>}</td><tr><td class="linenos" data-pseudo-content="36"></td><td></td><tr><td class="linenos" data-pseudo-content="37"></td><td><span class="hljs-keyword">call</span> plug#end()</td></table></code></pre>
<p>As always, it’s a good idea to comment your config and try to group things logically. Note that I have one plugin of my own listed here - this is just a collection of settings for different filetypes, such as making Javascript files use 2 spaces for indentation, and it’s easier to keep that in a repository and pull it in as a dependency.</p>
<h2 id="completion">Completion</h2>
<p>The next part of the config deals with configuration. Most of the time the default omnicompletion is pretty good, but in the process of building out this config, I discovered PHPActor, which has massively improved my development experience with PHP - it finally provides completion as good as most IDE’s, and also provides similar refactoring tools. My config for completion currently looks like this:</p>
<pre><code class="hljs lang-vim"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-comment">"Completion</span></td><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-keyword">autocmd</span> FileType * <span class="hljs-keyword">setlocal</span> formatoptions-=<span class="hljs-keyword">c</span> formatoptions-=r formatoptions-=<span class="hljs-keyword">o</span></td><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-keyword">set</span> ofu=syntaxcomplete#Complete</td><tr><td class="linenos" data-pseudo-content="4"></td><td><span class="hljs-keyword">autocmd</span> FileType php <span class="hljs-keyword">setlocal</span> omnifunc=phpactor#Complete</td><tr><td class="linenos" data-pseudo-content="5"></td><td><span class="hljs-keyword">let</span> <span class="hljs-variable">g:phpactorOmniError</span> = <span class="hljs-variable">v:true</span></td><tr><td class="linenos" data-pseudo-content="6"></td><td><span class="hljs-keyword">autocmd</span> BufEnter * <span class="hljs-keyword">call</span> ncm2#enable_for_buffer()</td><tr><td class="linenos" data-pseudo-content="7"></td><td><span class="hljs-keyword">set</span> completeopt=noinsert,menuone,noselect</td></table></code></pre>
<h2 id="general-config">General config</h2>
<p>This is a set of standard settings for the general behaviour of the application, such as setting the colorscheme and default indentation levels. I also routinely disable the mouse because it bugs me.</p>
<pre><code class="hljs lang-vim"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-comment">"General</span></td><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-keyword">syntax</span> <span class="hljs-keyword">on</span></td><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-keyword">colorscheme</span> jellybeans</td><tr><td class="linenos" data-pseudo-content="4"></td><td><span class="hljs-keyword">set</span> <span class="hljs-keyword">nu</span></td><tr><td class="linenos" data-pseudo-content="5"></td><td><span class="hljs-keyword">filetype</span> plugin <span class="hljs-built_in">indent</span> <span class="hljs-keyword">on</span></td><tr><td class="linenos" data-pseudo-content="6"></td><td><span class="hljs-keyword">set</span> nocp</td><tr><td class="linenos" data-pseudo-content="7"></td><td><span class="hljs-keyword">set</span> ruler</td><tr><td class="linenos" data-pseudo-content="8"></td><td><span class="hljs-keyword">set</span> wildmenu</td><tr><td class="linenos" data-pseudo-content="9"></td><td><span class="hljs-keyword">set</span> mouse-=<span class="hljs-keyword">a</span></td><tr><td class="linenos" data-pseudo-content="10"></td><td><span class="hljs-keyword">set</span> t_Co=<span class="hljs-number">256</span></td><tr><td class="linenos" data-pseudo-content="11"></td><td></td><tr><td class="linenos" data-pseudo-content="12"></td><td><span class="hljs-comment">"Code folding</span></td><tr><td class="linenos" data-pseudo-content="13"></td><td><span class="hljs-keyword">set</span> foldmethod=manual</td><tr><td class="linenos" data-pseudo-content="14"></td><td></td><tr><td class="linenos" data-pseudo-content="15"></td><td><span class="hljs-comment">"Tabs and spacing</span></td><tr><td class="linenos" data-pseudo-content="16"></td><td><span class="hljs-keyword">set</span> autoindent</td><tr><td class="linenos" data-pseudo-content="17"></td><td><span class="hljs-keyword">set</span> <span class="hljs-built_in">cindent</span></td><tr><td class="linenos" data-pseudo-content="18"></td><td><span class="hljs-keyword">set</span> tabstop=<span class="hljs-number">4</span></td><tr><td class="linenos" data-pseudo-content="19"></td><td><span class="hljs-keyword">set</span> expandtab</td><tr><td class="linenos" data-pseudo-content="20"></td><td><span class="hljs-keyword">set</span> <span class="hljs-built_in">shiftwidth</span>=<span class="hljs-number">4</span></td><tr><td class="linenos" data-pseudo-content="21"></td><td><span class="hljs-keyword">set</span> smarttab</td><tr><td class="linenos" data-pseudo-content="22"></td><td></td><tr><td class="linenos" data-pseudo-content="23"></td><td><span class="hljs-comment">"Search</span></td><tr><td class="linenos" data-pseudo-content="24"></td><td><span class="hljs-keyword">set</span> hlsearch</td><tr><td class="linenos" data-pseudo-content="25"></td><td><span class="hljs-keyword">set</span> incsearch</td><tr><td class="linenos" data-pseudo-content="26"></td><td><span class="hljs-keyword">set</span> ignorecase</td><tr><td class="linenos" data-pseudo-content="27"></td><td><span class="hljs-keyword">set</span> smartcase</td><tr><td class="linenos" data-pseudo-content="28"></td><td><span class="hljs-keyword">set</span> diffopt +=iwhite</td></table></code></pre>
<h2 id="markdown-configuration">Markdown configuration</h2>
<p>This section sets the file type for Markdown. It disables the Markdown plugin included in <code>vim-polyglot</code> as I had problems with it, and sets the languages that will be highlighted in fenced code blocks. I may at some point migrate this to the filetype repository.</p>
<pre><code class="hljs lang-vim"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-comment">"Syntax highlighting in Markdown</span></td><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-keyword">au</span> BufNewFile,BufReadPost *.md <span class="hljs-keyword">set</span> <span class="hljs-keyword">filetype</span>=markdown</td><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-keyword">let</span> <span class="hljs-variable">g:polyglot_disabled</span> = [<span class="hljs-string">'markdown'</span>]</td><tr><td class="linenos" data-pseudo-content="4"></td><td><span class="hljs-keyword">let</span> <span class="hljs-variable">g:markdown_fenced_languages</span> = [<span class="hljs-string">'bash=sh'</span>, <span class="hljs-string">'css'</span>, <span class="hljs-string">'django'</span>, <span class="hljs-string">'javascript'</span>, <span class="hljs-string">'js=javascript'</span>, <span class="hljs-string">'json=javascript'</span>, <span class="hljs-string">'perl'</span>, <span class="hljs-string">'php'</span>, <span class="hljs-string">'python'</span>, <span class="hljs-string">'ruby'</span>, <span class="hljs-string">'sass'</span>, <span class="hljs-string">'xml'</span>, <span class="hljs-string">'html'</span>, <span class="hljs-string">'vim'</span>]</td></table></code></pre>
<h2 id="neomake">Neomake</h2>
<p>I used to use Syntastic for checking my code for errors, but I’ve always found it problematic - it was slow and would often block the editor for some time. Neovim does have support for asynchronous jobs (as does Vim 8), but Syntastic doesn’t use it, so I decided to look elsewhere.</p>
<p>Neomake seemed a lot better, so I migrated over to it. It doesn’t require much configuration, and it’s really fast - unlike Syntastic, it supports asynchronous jobs. This part of the config sets it up to run on changes with no delay in writing, so I get near-instant feedback if a syntax error creeps in, and it doesn’t block the editor the way Syntastic used to.</p>
<pre><code class="hljs lang-vim"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-comment">" Neomake config</span></td><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-comment">" Full config: when writing or reading a buffer, and on changes in insert and</span></td><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-comment">" normal mode (after 1s; no delay when writing).</span></td><tr><td class="linenos" data-pseudo-content="4"></td><td><span class="hljs-keyword">call</span> neomake#configure#automake(<span class="hljs-string">'nrwi'</span>, <span class="hljs-number">500</span>)</td></table></code></pre>
<h2 id="phpactor">PHPActor</h2>
<p>As mentioned above, PHPActor has dramatically improved my experience when coding in PHP by providing access to features normally found only in full IDE’s. Here’s the fairly standard config I use for the refactoring functionality:</p>
<pre><code class="hljs lang-vim"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-comment">" PHPActor config</span></td><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-comment">" Include use statement</span></td><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-keyword">nmap</span> <span class="hljs-symbol">&lt;Leader&gt;</span><span class="hljs-keyword">u</span> :<span class="hljs-keyword">call</span> phpactor#UseAdd()<span class="hljs-symbol">&lt;CR&gt;</span></td><tr><td class="linenos" data-pseudo-content="4"></td><td></td><tr><td class="linenos" data-pseudo-content="5"></td><td><span class="hljs-comment">" Invoke the context menu</span></td><tr><td class="linenos" data-pseudo-content="6"></td><td><span class="hljs-keyword">nmap</span> <span class="hljs-symbol">&lt;Leader&gt;</span>mm :<span class="hljs-keyword">call</span> phpactor#ContextMenu()<span class="hljs-symbol">&lt;CR&gt;</span></td><tr><td class="linenos" data-pseudo-content="7"></td><td></td><tr><td class="linenos" data-pseudo-content="8"></td><td><span class="hljs-comment">" Invoke the navigation menu</span></td><tr><td class="linenos" data-pseudo-content="9"></td><td><span class="hljs-keyword">nmap</span> <span class="hljs-symbol">&lt;Leader&gt;</span><span class="hljs-keyword">nn</span> :<span class="hljs-keyword">call</span> phpactor#Navigate()<span class="hljs-symbol">&lt;CR&gt;</span></td><tr><td class="linenos" data-pseudo-content="10"></td><td></td><tr><td class="linenos" data-pseudo-content="11"></td><td><span class="hljs-comment">" Goto definition of class or class member under the cursor</span></td><tr><td class="linenos" data-pseudo-content="12"></td><td><span class="hljs-keyword">nmap</span> <span class="hljs-symbol">&lt;Leader&gt;</span><span class="hljs-keyword">o</span> :<span class="hljs-keyword">call</span> phpactor#GotoDefinition()<span class="hljs-symbol">&lt;CR&gt;</span></td><tr><td class="linenos" data-pseudo-content="13"></td><td></td><tr><td class="linenos" data-pseudo-content="14"></td><td><span class="hljs-comment">" Transform the classes in the current file</span></td><tr><td class="linenos" data-pseudo-content="15"></td><td><span class="hljs-keyword">nmap</span> <span class="hljs-symbol">&lt;Leader&gt;</span>tt :<span class="hljs-keyword">call</span> phpactor#Transform()<span class="hljs-symbol">&lt;CR&gt;</span></td><tr><td class="linenos" data-pseudo-content="16"></td><td></td><tr><td class="linenos" data-pseudo-content="17"></td><td><span class="hljs-comment">" Generate a new class (replacing the current file)</span></td><tr><td class="linenos" data-pseudo-content="18"></td><td><span class="hljs-keyword">nmap</span> <span class="hljs-symbol">&lt;Leader&gt;</span><span class="hljs-keyword">cc</span> :<span class="hljs-keyword">call</span> phpactor#ClassNew()<span class="hljs-symbol">&lt;CR&gt;</span></td><tr><td class="linenos" data-pseudo-content="19"></td><td></td><tr><td class="linenos" data-pseudo-content="20"></td><td><span class="hljs-comment">" Extract expression (normal mode)</span></td><tr><td class="linenos" data-pseudo-content="21"></td><td><span class="hljs-keyword">nmap</span> <span class="hljs-symbol">&lt;silent&gt;</span><span class="hljs-symbol">&lt;Leader&gt;</span>ee :<span class="hljs-keyword">call</span> phpactor#ExtractExpression(<span class="hljs-variable">v:false</span>)<span class="hljs-symbol">&lt;CR&gt;</span></td><tr><td class="linenos" data-pseudo-content="22"></td><td></td><tr><td class="linenos" data-pseudo-content="23"></td><td><span class="hljs-comment">" Extract expression from selection</span></td><tr><td class="linenos" data-pseudo-content="24"></td><td><span class="hljs-keyword">vmap</span> <span class="hljs-symbol">&lt;silent&gt;</span><span class="hljs-symbol">&lt;Leader&gt;</span>ee :<span class="hljs-symbol">&lt;C-U&gt;</span><span class="hljs-keyword">call</span> phpactor#ExtractExpression(<span class="hljs-variable">v:true</span>)<span class="hljs-symbol">&lt;CR&gt;</span></td><tr><td class="linenos" data-pseudo-content="25"></td><td></td><tr><td class="linenos" data-pseudo-content="26"></td><td><span class="hljs-comment">" Extract method from selection</span></td><tr><td class="linenos" data-pseudo-content="27"></td><td><span class="hljs-keyword">vmap</span> <span class="hljs-symbol">&lt;silent&gt;</span><span class="hljs-symbol">&lt;Leader&gt;</span><span class="hljs-keyword">em</span> :<span class="hljs-symbol">&lt;C-U&gt;</span><span class="hljs-keyword">call</span> phpactor#ExtractMethod()<span class="hljs-symbol">&lt;CR&gt;</span></td></table></code></pre>
<h2 id="summary">Summary</h2>
<p>Vim or Neovim configuration files are never static. Your needs are always changing, and you’re constantly discovering new plugins and new settings to try out, and keeping ones that prove useful. It’s been helpful to start over and ditch some plugins I no longer needed, pull in some new ones, and organise my configuration a bit better.</p>
<p>Now that I can set the dependencies in a text file rather than pulling them in as Git submodules, it makes more sense to keep my config in a <a href="https://gist.github.com/matthewbdaly/80b777ad3db885ebeecd27687fb121cd">Github Gist</a> rather than a Git repository, and that’s where I plan to retain it for now. Feel free to fork or cannibalize it for your own purposes if you wish.</p>
]]></description>
        </item>
    </channel>
</rss>