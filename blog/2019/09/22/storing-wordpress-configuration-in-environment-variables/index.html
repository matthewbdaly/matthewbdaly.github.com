<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="theme-color" content="#252525"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="description" content="I&#x27;m a web developer in Norfolk. This is my blog..."><meta name="keywords" content="php,wordpress"><link rel="amphtml" href="https://matthewdaly.co.uk/blog/2019/09/22/storing-wordpress-configuration-in-environment-variables/amp/"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; child-src 'none'; frame-src disqus.com *.addthis.com; object-src 'none'; font-src 'self' fonts.google-apis.com fonts.gstatic.com; style-src 'self' fonts.googleapis.com *.addthis.com google-analytics.com *.disquscdn.com *.disqus.com 'unsafe-inline'; script-src 'self' localhost:* *.addthis.com *.google-analytics.com *.disquscdn.com *.disqus.com disqus.com *.addthisedge.com graph.facebook.com 'unsafe-inline' 'unsafe-eval'; connect-src 'self' ws://localhost:*; img-src 'self' *.google-analytics.com *.disquscdn.com *.disqus.com stats.g.doubleclick.net"><link rel="canonical" href="https://matthewdaly.co.uk/blog/2019/09/22/storing-wordpress-configuration-in-environment-variables/"><link href="/opensearch.xml" rel="search" title="Matthew Daly's Blog Search" type="application/opensearchdescription+xml"><link href="/favicon.ico" rel="icon"><link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=PT+Serif" media="all"><link rel="stylesheet" type="text/css" href="/static/css/style.min.css" media="all"><link rel="alternate" type="application/rss+xml" title="Matthew Daly&#x27;s Blog - feed" href="/rss.xml"><link rel="alternate" type="application/atom+xml" title="Matthew Daly&#x27;s Blog - feed" href="/atom.xml"><link rel="pingback" href="https://webmention.io/matthewdaly.co.uk/xmlrpc"><link rel="webmention" href="https://webmention.io/matthewdaly.co.uk/webmention"><title>Storing Wordpress Configuration in Environment Variables - Matthew Daly&#x27;s Blog</title></head><body><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=MattBD" async="async"></script><header><div class="container headercontainer"><div class="jumbotron"><h1><a href="/">Matthew Daly&#x27;s Blog</a></h1><h2>I&#x27;m a web developer in Norfolk. This is my blog...</h2></div></div><div class="container headercontainer"><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav mr-auto"><li class="nav-item active"><a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a></li><li class="nav-item active"><a class="nav-link" href="/blog/archives/">Archives</a></li><li class="nav-item active"><a class="nav-link" href="/about/">About</a></li><li class="nav-item active"><a class="nav-link" href="/uses/">Uses</a></li><li class="nav-item active"><a class="nav-link" href="/rss.xml">RSS</a></li><li class="nav-item dropdown d-lg-none"><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/">Home</a> <a class="dropdown-item" href="/blog/archives/">Archives</a> <a class="dropdown-item" href="/about/">About</a> <a class="dropdown-item" href="/uses/">Uses</a> <a class="dropdown-item" href="/rss.xml">RSS</a></div></li></ul><form class="form-inline my-2 my-lg-0" action="https://www.google.com/search" method="GET" name="searchForm" id="searchForm" enctype="application/x-www-form-urlencoded"><input type="hidden" id="sitesearch" value="matthewdaly.co.uk"> <input class="form-control mr-sm-2" id="search" name="q" maxlength="200" autocomplete="off" type="search" placeholder="Search" aria-label="Search"><ul class="searchresults"></ul></form></div></nav></div></header><div id="mainbody" class="container"><div class="row"><div class="col-md-8"><article class="post"><p class="date">22nd September 2019 7:00 pm</p><h1>Storing Wordpress Configuration in Environment Variables</h1><p>Wordpress configuration can be a serious pain in the proverbial. Hard-coding configuration details in a PHP file is not a terribly safe way of storing the details for your database, as if the server is misconfigured they can be exposed. In addition, it can be a chore to copy and populate the <code>wp-config.php</code> file to a new deploy.</p><p>A fundamental principle of <a href="https://12factor.net/">The Twelve-Factor App</a> is that config should be stored in the environment. While Wordpress does predate this, there’s no reason why we can’t abide by this. Storing Wordpress configuration in environment variables rather than the <code>wp-config.php</code> file has the following advantages:</p><ul><li>It’s more secure since the config is not stored in a file in the web root, but in the web server config</li><li>It makes managing the <code>wp-config.php</code> file less of a chore - it can be safely committed to version control, and you won’t need to change it to match your local configuration, running the risk of accidentally committing and pushing to production with broken config</li><li>Deployment to new servers is simpler because there’s no need to update the <code>wp-config.php</code></li><li>The risk of neglecting to change the database details and accidentally messing up the production database when working locally is virtually eliminated</li></ul><p>I’ve seen solutions for this that use DotEnv, but you don’t actually need to install that to be able to use environment variables with Wordpress. In fact, in some way it’s better if you don’t as too many developers use <code>.env</code> files in production. PHP natively has the ability to get data from environment variables using the <code>getenv()</code> function, so it’s easier to use that than to pull in a third-party library.</p><p>Here’s an abbreviated example of a <code>wp-config.php</code> file that’s been updated to pull the settings from environment variables:</p><pre><code class="hljs lang-php"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-meta">&lt;?php</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-comment">// ** MySQL settings - You can get this info from your web host ** //</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-comment">/** The name of the database for WordPress */</span></td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>define( <span class="hljs-string">'DB_NAME'</span>, getenv(<span class="hljs-string">'DB_NAME'</span>) );</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td><span class="hljs-comment">/** MySQL database username */</span></td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>define( <span class="hljs-string">'DB_USER'</span>, getenv(<span class="hljs-string">'DB_USER'</span>) );</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td><span class="hljs-comment">/** MySQL database password */</span></td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>define( <span class="hljs-string">'DB_PASSWORD'</span>, getenv(<span class="hljs-string">'DB_PASSWORD'</span>) );</td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td><span class="hljs-comment">/** MySQL hostname */</span></td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>define( <span class="hljs-string">'DB_HOST'</span>, getenv(<span class="hljs-string">'DB_HOST'</span>) );</td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td><span class="hljs-comment">/** Database Charset to use in creating database tables. */</span></td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td>define( <span class="hljs-string">'DB_CHARSET'</span>, <span class="hljs-string">'utf8'</span> );</td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td><span class="hljs-comment">/** The Database Collate type. Don't change this if in doubt. */</span></td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td>define( <span class="hljs-string">'DB_COLLATE'</span>, <span class="hljs-string">''</span> );</td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td>define( <span class="hljs-string">'AUTH_KEY'</span>,         getenv(<span class="hljs-string">'AUTH_KEY'</span>) );</td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td>define( <span class="hljs-string">'SECURE_AUTH_KEY'</span>,  getenv(<span class="hljs-string">'SECURE_AUTH_KEY'</span>) );</td></tr><tr><td class="linenos" data-pseudo-content="23"></td><td>define( <span class="hljs-string">'LOGGED_IN_KEY'</span>,    getenv(<span class="hljs-string">'LOGGED_IN_KEY'</span>) );</td></tr><tr><td class="linenos" data-pseudo-content="24"></td><td>define( <span class="hljs-string">'NONCE_KEY'</span>,        getenv(<span class="hljs-string">'NONCE_KEY'</span>) );</td></tr><tr><td class="linenos" data-pseudo-content="25"></td><td>define( <span class="hljs-string">'AUTH_SALT'</span>,        getenv(<span class="hljs-string">'AUTH_SALT'</span>) );</td></tr><tr><td class="linenos" data-pseudo-content="26"></td><td>define( <span class="hljs-string">'SECURE_AUTH_SALT'</span>, getenv(<span class="hljs-string">'SECURE_AUTH_SALT'</span>) );</td></tr><tr><td class="linenos" data-pseudo-content="27"></td><td>define( <span class="hljs-string">'LOGGED_IN_SALT'</span>,   getenv(<span class="hljs-string">'LOGGED_IN_SALT'</span>) );</td></tr><tr><td class="linenos" data-pseudo-content="28"></td><td>define( <span class="hljs-string">'NONCE_SALT'</span>,       getenv(<span class="hljs-string">'NONCE_SALT'</span>) );</td></tr><tr><td class="linenos" data-pseudo-content="29"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="30"></td><td>$table_prefix = <span class="hljs-string">'wp_'</span>;</td></tr><tr><td class="linenos" data-pseudo-content="31"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="32"></td><td>define( <span class="hljs-string">'WP_DEBUG'</span>, getenv(<span class="hljs-string">'WP_DEBUG'</span>) );</td></tr><tr><td class="linenos" data-pseudo-content="33"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="34"></td><td><span class="hljs-comment">/* That's all, stop editing! Happy publishing. */</span></td></tr><tr><td class="linenos" data-pseudo-content="35"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="36"></td><td><span class="hljs-comment">/** Absolute path to the WordPress directory. */</span></td></tr><tr><td class="linenos" data-pseudo-content="37"></td><td><span class="hljs-keyword">if</span> ( ! defined( <span class="hljs-string">'ABSPATH'</span> ) ) {</td></tr><tr><td class="linenos" data-pseudo-content="38"></td><td>    define( <span class="hljs-string">'ABSPATH'</span>, dirname( <span class="hljs-keyword">__FILE__</span> ) . <span class="hljs-string">'/'</span> );</td></tr><tr><td class="linenos" data-pseudo-content="39"></td><td>}</td></tr><tr><td class="linenos" data-pseudo-content="40"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="41"></td><td><span class="hljs-comment">/** Sets up WordPress vars and included files. */</span></td></tr><tr><td class="linenos" data-pseudo-content="42"></td><td><span class="hljs-keyword">require_once</span>( ABSPATH . <span class="hljs-string">'wp-settings.php'</span> );</td></tr></table></code></pre><p>If you’re using Lando for local development, you will need to specify a file to include that contains the environment variables you wish to set, as in this example:</p><pre><code class="hljs lang-yaml"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-attr">name:</span> <span class="hljs-string">wordpress</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-attr">recipe:</span> <span class="hljs-string">wordpress</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-attr">config:</span></td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>  <span class="hljs-attr">webroot:</span> <span class="hljs-string">.</span></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td><span class="hljs-attr">env_file:</span></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>  <span class="hljs-bullet">-</span> <span class="hljs-string">.env</span></td></tr></table></code></pre><p>This filename can be any arbitrarily chosen name. Then, you define the values for those variables in the same way you normally would in a <code>.env</code> file. Here’s an abbreviated example that excludes the crypto settings (though those should be placed here too):</p><pre><code class="hljs lang-env"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-attribute">DB_NAME</span>=wordpress</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-attribute">DB_USER</span>=wordpress</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-attribute">DB_PASSWORD</span>=wordpress</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td><span class="hljs-attribute">DB_HOST</span>=database</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td><span class="hljs-attribute">WP_DEBUG</span>=<span class="hljs-literal">true</span></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td><span class="hljs-built_in">..</span>.</td></tr></table></code></pre><p>This will work fine during local development, but in production, or if you’re using something like Vagrant for local development, you’ll want to set the environment variables in the server configuration. For Apache, this is best set in the Virtualhost configuration, although you should be able to set it in an <code>.htaccess</code> file if all else fails. You need to use the <code>SetEnv</code> directive, as in this example:</p><pre><code class="hljs lang-apache"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-attribute"><span class="hljs-nomarkup">SetEnv</span></span> DB_NAME wordpress</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-attribute"><span class="hljs-nomarkup">SetEnv</span></span> DB_USER wordpress</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-attribute"><span class="hljs-nomarkup">SetEnv</span></span> DB_PASSWORD wordpress</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td><span class="hljs-attribute"><span class="hljs-nomarkup">SetEnv</span></span> DB_HOST database</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td><span class="hljs-attribute"><span class="hljs-nomarkup">SetEnv</span></span> WP_DEBUG true</td></tr></table></code></pre><p>For Nginx, assuming you’re using FastCGI, you need to set it in the server configuration for that site using the <code>fastcgi_param</code> directive, as shown below:</p><pre><code class="hljs lang-nginx"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-attribute">fastcgi_param</span> DB_NAME wordpress;</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-attribute">fastcgi_param</span> DB_USER wordpress;</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-attribute">fastcgi_param</span> DB_PASSWORD wordpress;</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td><span class="hljs-attribute">fastcgi_param</span> DB_HOST database;</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td><span class="hljs-attribute">fastcgi_param</span> WP_DEBUG <span class="hljs-literal">true</span>;</td></tr></table></code></pre><p>Since Wordpress doesn’t ship with any kind of command-line task runner, this should be sufficient for most installs. However, if you’re using WP CLI, that will break it as it won’t have access to environment variables set by Apache or Nginx, so you’ll also need to set them for the user that runs WP CLI by adding them to their Bash config in the usual way.</p><ul class="categorylist"><li><a href="/blog/categories/php/">php</a></li><li><a href="/blog/categories/wordpress/">wordpress</a></li></ul><div class="addthis_sharing_toolbox"></div><section class="comments"><div id="disqus_thread"></div><script>var disqus_config = function () {
                        this.page.url = "https://matthewdaly.co.uk/blog/2019/09/22/storing-wordpress-configuration-in-environment-variables/";
                        this.page.identifier = "https://matthewdaly.co.uk/blog/2019/09/22/storing-wordpress-configuration-in-environment-variables/";
                     };
                  (function() { // DON'T EDIT BELOW THIS LINE
                     var d = document, s = d.createElement('script');
                     s.src = 'https://matthewdaly.disqus.com/embed.js';
                     s.setAttribute('data-timestamp', +new Date());
                     (d.head || d.body).appendChild(s);
                  })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></section></article></div><div class="col-md-4"><h1>Recent Posts</h1><p><a href="/blog/2020/12/30/lightweight-laravel-deconstructing-a-full-stack-framework/">Lightweight Laravel - Deconstructing a Full Stack Framework</a></p><p><a href="/blog/2020/09/28/what-i-want-in-a-php-cms/">What I Want in a PHP CMS</a></p><p><a href="/blog/2020/06/13/flow-typed-ajax-responses-with-react-hooks/">Flow Typed AJAX Responses With React Hooks</a></p><p><a href="/blog/2020/03/11/caching-the-laravel-user-provider-with-a-decorator/">Caching the Laravel User Provider With a Decorator</a></p><p><a href="/blog/2020/02/12/the-trouble-with-integrated-static-analysis/">The Trouble With Integrated Static Analysis</a></p><section><h2>About me</h2><p>I'm a web and mobile app developer based in Norfolk. My skillset includes Python, PHP and Javascript, and I have extensive experience working with CodeIgniter, Laravel, Zend Framework, Django, Phonegap and React.js.</p></section><section id="links"><h2>Links</h2><a href="https://github.com/matthewbdaly" rel="me">GitHub</a> <a href="https://twitter.com/MattBD" rel="me">Twitter</a> <a href="http://stackoverflow.com/users/63717/matthew-daly">Stack Overflow</a> <a href="https://dev.to/matthewbdaly" rel="me">Dev.to</a></section></div></div><div class="row"><div class="col-md-12"><ul class="pagination"><li class="page-item"><a class="page-link" href="/blog/2019/09/21/using-mix-versioning-outside-laravel/">&lt; Using Mix Versioning Outside Laravel</a></li><li class="page-item"><a class="page-link" href="/blog/2019/10/13/flexible-data-types-with-the-json-field/">Flexible Data Types With the JSON Field &gt;</a></li></ul></div></div></div><footer><div class="container footercontainer"><div class="col-md-12"><p class="copyright">Copyright &copy; Matthew Daly 2021.</p></div></div></footer><script type="text/javascript" src="/static/js/all.min.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-17043630-1');ga('send','pageview');</script><script id="dsq-count-scr" src="//matthewdaly.disqus.com/count.js" async></script></body></html>