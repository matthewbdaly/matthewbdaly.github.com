<!doctype html><html amp lang="en"><head><meta charset="utf-8"><title>Storing Wordpress Configuration in Environment Variables - Matthew Daly&#x27;s Blog</title><link rel="canonical" href="https://matthewdaly.co.uk/blog/2019/09/22/storing-wordpress-configuration-in-environment-variables/"><link rel="alternate" type="application/rss+xml" title="Matthew Daly&#x27;s Blog - feed" href="/rss.xml"><link href="/favicon.ico" rel="icon"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#252525"><script type="application/ld+json">{
         "@context": "http://schema.org",
         "@type": "BlogPosting",
         "mainEntityOfPage": "https://matthewdaly.co.uk/blog/2019/09/22/storing-wordpress-configuration-in-environment-variables/",
         "headline": "Storing Wordpress Configuration in Environment Variables",
         "datePublished": "2019-09-22T18:00:34.000Z",
         "dateModified": "2019-09-22T18:00:34.000Z",
         "description": "&lt;p&gt;Wordpress configuration can be a serious pain in the proverbial. Hard-coding configuration detail...",
         "author": {
              "@type": "Person",
              "name": "Matthew Daly"
         },
         "publisher": {
            "@type": "Organization",
            "name": "Matthew Daly&#x27;s Blog",
            "logo": {
               "@type": "ImageObject",
               "url": "https://matthewdaly.co.uk/favicon.ico",
               "height": 16,
               "width": 16
            }
         },
         "image": {
            "@type": "ImageObject",
            "url": "https://matthewdaly.co.uk/logo.png",
            "height": 120,
            "width": 1200
         }
      }</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><link href="https://fonts.googleapis.com/css?family=PT+Serif" rel="stylesheet" type="text/css"><style amp-custom>body {
   background-color: #252525;
}
      div.container {
         background-color: #f8f8f8;
         width: 100%;
      }
      p, h1, h2, h3, h4, h5, h6, li, nav a {
         font-family: "PT Serif","Georgia","Helvetica Neue",Arial,sans-serif;
         text-rendering: optimizelegibility;
      }
      p, li {
         font-size: 1.4em;
         line-height: 1.5em;
      }
      header {
         padding: 20px;
         color: #505050;
      }
      header h1 {
         font-size: 3em;
         line-height: 1.2em;
         color: #7f7f7f;
      }
      header h2 {
         font-size: 1.5em;
         color: #7f7f7f;
      }
      h1 a {
         text-decoration: none;
         color: #7f7f7f;
      }
      code {
         white-space: pre-wrap;
         word-wrap: break-word;
         font-family: Menlo, Monaco, "Andale Mono", "Ubuntu Mono", "lucida console", monospace;
         background-color: #cfcfcf;
         padding: 5px;
         border-radius: 3px;
      }
      pre {
         white-space: pre-wrap;
         word-wrap: break-word;
      }
      pre code {
         display: block;
         overflow-wrap: normal;
         word-wrap: normal;
         white-space: pre;
         font-size: 1.2em;
      }
      article {
         padding: 20px;
      }
      section {
         margin-top: 10px;
         margin-bottom: 10px;
      }
      amp-img {
         background-color: gray;
         border: 1px solid black;
      }
      .hljs {
         display: block;
         overflow-x: auto;
         padding: 0.5em;
         background: #474949;
         color: #d1d9e1;
      }
      .hljs-comment,
      .hljs-quote {
         color: #969896;
         font-style: italic;
      }
      .hljs-keyword,
      .hljs-selector-tag,
      .hljs-literal,
      .hljs-type,
      .hljs-addition {
         color: #cc99cc;
      }
      .hljs-number,
      .hljs-selector-attr,
      .hljs-selector-pseudo {
         color: #f99157;
      }
      .hljs-string,
      .hljs-doctag,
      .hljs-regexp {
         color: #8abeb7;
      }
      .hljs-title,
      .hljs-name,
      .hljs-section,
      .hljs-built_in {
         color: #b5bd68;
      }
      .hljs-variable,
      .hljs-template-variable,
      .hljs-selector-id,
      .hljs-class .hljs-title {
         color: #ffcc66;
      }
      .hljs-section,
      .hljs-name,
      .hljs-strong {
         font-weight: bold;
      }
      .hljs-symbol,
      .hljs-bullet,
      .hljs-subst,
      .hljs-meta,
      .hljs-link {
         color: #f99157;
      }
      .hljs-deletion {
         color: #dc322f;
      }
      .hljs-formula {
         background: #eee8d5;
      }
      .hljs-attr,
      .hljs-attribute {
         color: #81a2be;
      }
      .hljs-emphasis {
         font-style: italic;
      }
      ul.categories {
         padding-left: 0px;
         margin-bottom: 20px;
      }
      ul.categories li {
         list-style-type: none;
         display: inline-block;
         margin-right: 20px;
      }
      ul.categories li a {
         background-color: #303030;
         border-radius: 3px;
         padding: 3px;
         color: #fff;
         text-decoration: none;
      }
      a.commentlink, a.postlink {
         background-color: #303030;
         border-radius: 3px;
         padding: 3px;
         color: #fff;
         text-decoration: none;
      }
      blockquote {
         font-style: italic;
         border-left: 2px solid #cfcfcf;
      }
      blockquote p {
         font-size: 2.2em;
      }</style><script async src="https://cdn.ampproject.org/v0.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script></head><body><header><h1><a href="/">Matthew Daly&#x27;s Blog</a></h1><h2>I&#x27;m a web developer in Norfolk. This is my blog...</h2></header><div class="container"><div class="row"><div class="col-md-8"><article class="post"><p class="date">22nd September 2019 7:00 pm</p><h1>Storing Wordpress Configuration in Environment Variables</h1><p>Wordpress configuration can be a serious pain in the proverbial. Hard-coding configuration details in a PHP file is not a terribly safe way of storing the details for your database, as if the server is misconfigured they can be exposed. In addition, it can be a chore to copy and populate the <code>wp-config.php</code> file to a new deploy.</p><p>A fundamental principle of <a href="https://12factor.net/">The Twelve-Factor App</a> is that config should be stored in the environment. While Wordpress does predate this, there’s no reason why we can’t abide by this. Storing Wordpress configuration in environment variables rather than the <code>wp-config.php</code> file has the following advantages:</p><ul><li>It’s more secure since the config is not stored in a file in the web root, but in the web server config</li><li>It makes managing the <code>wp-config.php</code> file less of a chore - it can be safely committed to version control, and you won’t need to change it to match your local configuration, running the risk of accidentally committing and pushing to production with broken config</li><li>Deployment to new servers is simpler because there’s no need to update the <code>wp-config.php</code></li><li>The risk of neglecting to change the database details and accidentally messing up the production database when working locally is virtually eliminated</li></ul><p>I’ve seen solutions for this that use DotEnv, but you don’t actually need to install that to be able to use environment variables with Wordpress. In fact, in some way it’s better if you don’t as too many developers use <code>.env</code> files in production. PHP natively has the ability to get data from environment variables using the <code>getenv()</code> function, so it’s easier to use that than to pull in a third-party library.</p><p>Here’s an abbreviated example of a <code>wp-config.php</code> file that’s been updated to pull the settings from environment variables:</p><pre><code class="hljs lang-php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">// ** MySQL settings - You can get this info from your web host ** //</span>
<span class="hljs-comment">/** The name of the database for WordPress */</span>
define( <span class="hljs-string">'DB_NAME'</span>, getenv(<span class="hljs-string">'DB_NAME'</span>) );

<span class="hljs-comment">/** MySQL database username */</span>
define( <span class="hljs-string">'DB_USER'</span>, getenv(<span class="hljs-string">'DB_USER'</span>) );

<span class="hljs-comment">/** MySQL database password */</span>
define( <span class="hljs-string">'DB_PASSWORD'</span>, getenv(<span class="hljs-string">'DB_PASSWORD'</span>) );

<span class="hljs-comment">/** MySQL hostname */</span>
define( <span class="hljs-string">'DB_HOST'</span>, getenv(<span class="hljs-string">'DB_HOST'</span>) );

<span class="hljs-comment">/** Database Charset to use in creating database tables. */</span>
define( <span class="hljs-string">'DB_CHARSET'</span>, <span class="hljs-string">'utf8'</span> );

<span class="hljs-comment">/** The Database Collate type. Don't change this if in doubt. */</span>
define( <span class="hljs-string">'DB_COLLATE'</span>, <span class="hljs-string">''</span> );

define( <span class="hljs-string">'AUTH_KEY'</span>,         getenv(<span class="hljs-string">'AUTH_KEY'</span>) );
define( <span class="hljs-string">'SECURE_AUTH_KEY'</span>,  getenv(<span class="hljs-string">'SECURE_AUTH_KEY'</span>) );
define( <span class="hljs-string">'LOGGED_IN_KEY'</span>,    getenv(<span class="hljs-string">'LOGGED_IN_KEY'</span>) );
define( <span class="hljs-string">'NONCE_KEY'</span>,        getenv(<span class="hljs-string">'NONCE_KEY'</span>) );
define( <span class="hljs-string">'AUTH_SALT'</span>,        getenv(<span class="hljs-string">'AUTH_SALT'</span>) );
define( <span class="hljs-string">'SECURE_AUTH_SALT'</span>, getenv(<span class="hljs-string">'SECURE_AUTH_SALT'</span>) );
define( <span class="hljs-string">'LOGGED_IN_SALT'</span>,   getenv(<span class="hljs-string">'LOGGED_IN_SALT'</span>) );
define( <span class="hljs-string">'NONCE_SALT'</span>,       getenv(<span class="hljs-string">'NONCE_SALT'</span>) );

$table_prefix = <span class="hljs-string">'wp_'</span>;

define( <span class="hljs-string">'WP_DEBUG'</span>, getenv(<span class="hljs-string">'WP_DEBUG'</span>) );

<span class="hljs-comment">/* That's all, stop editing! Happy publishing. */</span>

<span class="hljs-comment">/** Absolute path to the WordPress directory. */</span>
<span class="hljs-keyword">if</span> ( ! defined( <span class="hljs-string">'ABSPATH'</span> ) ) {
    define( <span class="hljs-string">'ABSPATH'</span>, dirname( <span class="hljs-keyword">__FILE__</span> ) . <span class="hljs-string">'/'</span> );
}

<span class="hljs-comment">/** Sets up WordPress vars and included files. */</span>
<span class="hljs-keyword">require_once</span>( ABSPATH . <span class="hljs-string">'wp-settings.php'</span> );
</code></pre><p>If you’re using Lando for local development, you will need to specify a file to include that contains the environment variables you wish to set, as in this example:</p><pre><code class="hljs lang-yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">wordpress</span>
<span class="hljs-attr">recipe:</span> <span class="hljs-string">wordpress</span>
<span class="hljs-attr">config:</span>
  <span class="hljs-attr">webroot:</span> <span class="hljs-string">.</span>
<span class="hljs-attr">env_file:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">.env</span>
</code></pre><p>This filename can be any arbitrarily chosen name. Then, you define the values for those variables in the same way you normally would in a <code>.env</code> file. Here’s an abbreviated example that excludes the crypto settings (though those should be placed here too):</p><pre><code class="hljs lang-env"><span class="hljs-attribute">DB_NAME</span>=wordpress
<span class="hljs-attribute">DB_USER</span>=wordpress
<span class="hljs-attribute">DB_PASSWORD</span>=wordpress
<span class="hljs-attribute">DB_HOST</span>=database
<span class="hljs-attribute">WP_DEBUG</span>=<span class="hljs-literal">true</span>
<span class="hljs-built_in">..</span>.
</code></pre><p>This will work fine during local development, but in production, or if you’re using something like Vagrant for local development, you’ll want to set the environment variables in the server configuration. For Apache, this is best set in the Virtualhost configuration, although you should be able to set it in an <code>.htaccess</code> file if all else fails. You need to use the <code>SetEnv</code> directive, as in this example:</p><pre><code class="hljs lang-apache"><span class="hljs-attribute"><span class="hljs-nomarkup">SetEnv</span></span> DB_NAME wordpress
<span class="hljs-attribute"><span class="hljs-nomarkup">SetEnv</span></span> DB_USER wordpress
<span class="hljs-attribute"><span class="hljs-nomarkup">SetEnv</span></span> DB_PASSWORD wordpress
<span class="hljs-attribute"><span class="hljs-nomarkup">SetEnv</span></span> DB_HOST database
<span class="hljs-attribute"><span class="hljs-nomarkup">SetEnv</span></span> WP_DEBUG true
</code></pre><p>For Nginx, assuming you’re using FastCGI, you need to set it in the server configuration for that site using the <code>fastcgi_param</code> directive, as shown below:</p><pre><code class="hljs lang-nginx"><span class="hljs-attribute">fastcgi_param</span> DB_NAME wordpress;
<span class="hljs-attribute">fastcgi_param</span> DB_USER wordpress;
<span class="hljs-attribute">fastcgi_param</span> DB_PASSWORD wordpress;
<span class="hljs-attribute">fastcgi_param</span> DB_HOST database;
<span class="hljs-attribute">fastcgi_param</span> WP_DEBUG <span class="hljs-literal">true</span>;
</code></pre><p>Since Wordpress doesn’t ship with any kind of command-line task runner, this should be sufficient for most installs. However, if you’re using WP CLI, that will break it as it won’t have access to environment variables set by Apache or Nginx, so you’ll also need to set them for the user that runs WP CLI by adding them to their Bash config in the usual way.</p><section><ul class="categories"><li><a href="/blog/categories/php/">php</a></li><li><a href="/blog/categories/wordpress/">wordpress</a></li></ul></section><section><a class="commentlink" href="https://matthewdaly.co.uk/blog/2019/09/22/storing-wordpress-configuration-in-environment-variables/">View the article with comments</a></section><section><a class="postlink" href="/blog/2019/10/13/flexible-data-types-with-the-json-field/amp/">Flexible Data Types With the JSON Field</a> <a class="postlink" href="/blog/2019/09/21/using-mix-versioning-outside-laravel/amp/">Using Mix Versioning Outside Laravel</a></section></article></div></div></div><amp-analytics type="googleanalytics" id="analytics1"><script type="application/json">{
					"vars": {
						"account": "UA-17043630-1"
					},
					"triggers": {
						"trackPageview": {
							"on": "visible",
							"request": "pageview"
						}
					}
				}</script></amp-analytics></body></html>