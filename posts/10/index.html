<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="theme-color" content="#252525"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="description" content="I&#x27;m a web developer in Norfolk. This is my blog..."><meta name="keywords" content="web,development,python,javascript,php,programming"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; child-src 'none'; frame-src disqus.com *.addthis.com; object-src 'none'; font-src 'self' fonts.google-apis.com fonts.gstatic.com; style-src 'self' fonts.googleapis.com *.addthis.com google-analytics.com *.disquscdn.com *.disqus.com 'unsafe-inline'; script-src 'self' localhost:* *.addthis.com *.google-analytics.com *.disquscdn.com *.disqus.com disqus.com *.addthisedge.com graph.facebook.com 'unsafe-inline' 'unsafe-eval'; connect-src 'self' ws://localhost:*; img-src 'self' *.google-analytics.com *.disquscdn.com *.disqus.com stats.g.doubleclick.net"><link rel="canonical" href="https://matthewdaly.co.uk/posts/10/"><link href="/opensearch.xml" rel="search" title="Matthew Daly's Blog Search" type="application/opensearchdescription+xml"><link href="/favicon.ico" rel="icon"><link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=PT+Serif" media="all"><link rel="stylesheet" type="text/css" href="/static/css/style.min.css" media="all"><link rel="alternate" type="application/rss+xml" title="Matthew Daly&#x27;s Blog - feed" href="/rss.xml"><link rel="alternate" type="application/atom+xml" title="Matthew Daly&#x27;s Blog - feed" href="/atom.xml"><link rel="pingback" href="https://webmention.io/matthewdaly.co.uk/xmlrpc"><link rel="webmention" href="https://webmention.io/matthewdaly.co.uk/webmention"><title>Matthew Daly&#x27;s Blog</title></head><body><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=MattBD" async="async"></script><header><div class="container headercontainer"><div class="jumbotron"><h1><a href="/">Matthew Daly&#x27;s Blog</a></h1><h2>I&#x27;m a web developer in Norfolk. This is my blog...</h2></div></div><div class="container headercontainer"><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav mr-auto"><li class="nav-item active"><a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a></li><li class="nav-item active"><a class="nav-link" href="/blog/archives/">Archives</a></li><li class="nav-item active"><a class="nav-link" href="/about/">About</a></li><li class="nav-item active"><a class="nav-link" href="/rss.xml">RSS</a></li><li class="nav-item dropdown d-lg-none"><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/">Home</a> <a class="dropdown-item" href="/blog/archives/">Archives</a> <a class="dropdown-item" href="/about/">About</a> <a class="dropdown-item" href="/rss.xml">RSS</a></div></li></ul><form class="form-inline my-2 my-lg-0" action="https://www.google.com/search" method="GET" name="searchForm" id="searchForm" enctype="application/x-www-form-urlencoded"><input type="hidden" id="sitesearch" value="matthewdaly.co.uk"> <input class="form-control mr-sm-2" id="search" name="q" maxlength="200" autocomplete="off" type="search" placeholder="Search" aria-label="Search"><ul class="searchresults"></ul></form></div></nav></div></header><div id="mainbody" class="container"><div class="row"><div class="col-md-8"><article class="post"><p class="date">8th January 2018 12:52 pm</p><h1><a href="/blog/2018/01/08/creating-an-artisan-task-to-set-up-a-user-account/">Creating An Artisan Task to Set Up a User Account</a></h1><p>When working with any Laravel application that implements authentication, you’ll need to set up a user account to be able to work with it. One way of doing that is to add a user in a seeder, but that’s only really suitable if every user is going to use the same details.</p><p>Instead, you may want to create an Artisan command to set up the user account. Here’s an example of a command that does that:</p><pre><code class="hljs lang-php"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-meta">&lt;?php</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Console</span>\<span class="hljs-title">Commands</span>;</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Console</span>\<span class="hljs-title">Command</span>;</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td><span class="hljs-keyword">use</span> <span class="hljs-title">Hash</span>;</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateUser</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Command</span></span></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>{</td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>    <span class="hljs-comment">/**</span></td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>     * The name and signature of the console command.</td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>     *</td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>     * <span class="hljs-doctag">@var</span> string</td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>     */</td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td>    <span class="hljs-keyword">protected</span> $signature = <span class="hljs-string">'create:user'</span>;</td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td>    <span class="hljs-comment">/**</span></td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td>     * The console command description.</td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td>     *</td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td>     * <span class="hljs-doctag">@var</span> string</td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td>     */</td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td>    <span class="hljs-keyword">protected</span> $description = <span class="hljs-string">'Creates a single user'</span>;</td></tr><tr><td class="linenos" data-pseudo-content="23"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="24"></td><td>    <span class="hljs-comment">/**</span></td></tr><tr><td class="linenos" data-pseudo-content="25"></td><td>     * Create a new command instance.</td></tr><tr><td class="linenos" data-pseudo-content="26"></td><td>     *</td></tr><tr><td class="linenos" data-pseudo-content="27"></td><td>     * <span class="hljs-doctag">@return</span> void</td></tr><tr><td class="linenos" data-pseudo-content="28"></td><td>     */</td></tr><tr><td class="linenos" data-pseudo-content="29"></td><td>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">()</span></span></td></tr><tr><td class="linenos" data-pseudo-content="30"></td><td>    {</td></tr><tr><td class="linenos" data-pseudo-content="31"></td><td>        <span class="hljs-keyword">parent</span>::__construct();</td></tr><tr><td class="linenos" data-pseudo-content="32"></td><td>    }</td></tr><tr><td class="linenos" data-pseudo-content="33"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="34"></td><td>    <span class="hljs-comment">/**</span></td></tr><tr><td class="linenos" data-pseudo-content="35"></td><td>     * Execute the console command.</td></tr><tr><td class="linenos" data-pseudo-content="36"></td><td>     *</td></tr><tr><td class="linenos" data-pseudo-content="37"></td><td>     * <span class="hljs-doctag">@return</span> mixed</td></tr><tr><td class="linenos" data-pseudo-content="38"></td><td>     */</td></tr><tr><td class="linenos" data-pseudo-content="39"></td><td>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span><span class="hljs-params">()</span></span></td></tr><tr><td class="linenos" data-pseudo-content="40"></td><td>    {</td></tr><tr><td class="linenos" data-pseudo-content="41"></td><td>        <span class="hljs-comment">// Get user model from config</span></td></tr><tr><td class="linenos" data-pseudo-content="42"></td><td>        $model = config(<span class="hljs-string">'auth.providers.users.model'</span>);</td></tr><tr><td class="linenos" data-pseudo-content="43"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="44"></td><td>        <span class="hljs-comment">// Let user know what this will do</span></td></tr><tr><td class="linenos" data-pseudo-content="45"></td><td>        <span class="hljs-keyword">$this</span>-&gt;info(<span class="hljs-string">'I\'ll ask you for the details I need to set up the user'</span>);</td></tr><tr><td class="linenos" data-pseudo-content="46"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="47"></td><td>        <span class="hljs-comment">// Get username</span></td></tr><tr><td class="linenos" data-pseudo-content="48"></td><td>        $name = <span class="hljs-keyword">$this</span>-&gt;ask(<span class="hljs-string">'Please provide the username'</span>);</td></tr><tr><td class="linenos" data-pseudo-content="49"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="50"></td><td>        <span class="hljs-comment">// Get email</span></td></tr><tr><td class="linenos" data-pseudo-content="51"></td><td>        $email = <span class="hljs-keyword">$this</span>-&gt;ask(<span class="hljs-string">'Please provide the email address'</span>);</td></tr><tr><td class="linenos" data-pseudo-content="52"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="53"></td><td>        <span class="hljs-comment">// Get password</span></td></tr><tr><td class="linenos" data-pseudo-content="54"></td><td>        $password = <span class="hljs-keyword">$this</span>-&gt;secret(<span class="hljs-string">'Please provide the password'</span>);</td></tr><tr><td class="linenos" data-pseudo-content="55"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="56"></td><td>        <span class="hljs-comment">// Create model</span></td></tr><tr><td class="linenos" data-pseudo-content="57"></td><td>        $user = <span class="hljs-keyword">new</span> $model;</td></tr><tr><td class="linenos" data-pseudo-content="58"></td><td>        $user-&gt;name = $name;</td></tr><tr><td class="linenos" data-pseudo-content="59"></td><td>        $user-&gt;email = $email;</td></tr><tr><td class="linenos" data-pseudo-content="60"></td><td>        $user-&gt;password = Hash::make($password);</td></tr><tr><td class="linenos" data-pseudo-content="61"></td><td>        $user-&gt;save();</td></tr><tr><td class="linenos" data-pseudo-content="62"></td><td>        <span class="hljs-keyword">$this</span>-&gt;info(<span class="hljs-string">'User saved'</span>);</td></tr><tr><td class="linenos" data-pseudo-content="63"></td><td>    }</td></tr><tr><td class="linenos" data-pseudo-content="64"></td><td>}</td></tr></table></code></pre><p>We fetch the user model from the config, before asking the user for the data we need. Then we insert it into the database and confirm it to the user.</p><p>Then we just need to register the command in <code>App\Console\Kernel.php</code>:</p><pre><code class="hljs lang-php"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>    <span class="hljs-keyword">protected</span> $commands = [</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>        \App\Console\Commands\CreateUser::class,</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>    ];</td></tr></table></code></pre><p>And we can run our command with <code>php artisan create:user</code>.</p></article><article class="post"><p class="date">7th January 2018 5:21 pm</p><h1><a href="/blog/2018/01/07/adding-comments-to-models-in-laravel/">Adding Comments to Models in Laravel</a></h1><p><a href="https://github.com/matthewbdaly/laravel-comments">Laravel Comments</a> is a package I recently released that allows you to add comments to any model in your application. Possible models you could use it to enable comments on might include:</p><ul><li>Blog posts</li><li>Forum posts</li><li>Issues on an issue tracker</li></ul><p>It’s loosely inspired by Django’s comments system.</p><h2 id="installation">Installation</h2><p>Run this command to install it:</p><pre><code class="hljs lang-bash singleline">$ composer require matthewbdaly/laravel-comments</code></pre><p>You will also need to run <code>php artisan migrate</code> to create the appropriate tables.</p><h2 id="making-a-model-commentable">Making a model commentable</h2><p>Add the following trait to a model to make it commentable:</p><pre><code class="hljs lang-php singleline">Matthewbdaly\LaravelComments\Eloquent\Traits\Commentable</code></pre><p>The comments table uses a polymorphic relation, so it should be possible to attach it to pretty much any model. The model should now have a <code>comments</code> relation, allowing you to get the comments for a model instance.</p><h2 id="displaying-the-comments">Displaying the comments</h2><p>Obviously you can just render the comments in a view you can create yourself, but it’s usually going to be more convenient to use the existing view, even if just as a starting point, which includes the ability to submit new comments and flag existing ones. Include it in your views as follows:</p><pre><code class="hljs lang-php singleline">@<span class="hljs-keyword">include</span>(<span class="hljs-string">'comments::comments'</span>, [<span class="hljs-string">'parent'</span> =&gt; $post])</code></pre><p>The argument passed to <code>parent</code> should be the model instance for which you want to display the comments form. Obviously, you can easily override this to use your own custom form instead.</p><p>The package also contains the following views:</p><ul><li><code>comments::commentsubmitted</code></li><li><code>comments::flagsubmitted</code></li></ul><p>These are basically just acknowledgement screens for when a comment has been submitted or flagged, and you’ll probably want to override them.</p><p>The package also has its own routes and controller included for submitting comments and flags.</p><h2 id="using-the-models-directly">Using the models directly</h2><p>Of course there’s nothing stopping you creating your own routes and controllers for creating, viewing and flagging comments, and if, for instance, you wish to build a REST API that allows for adding comments to objects you can just use these models directly:</p><ul><li><code>Matthewbdaly\LaravelComments\Eloquent\Models\Comment</code></li><li><code>Matthewbdaly\LaravelComments\Eloquent\Models\Comment\Flag</code></li></ul><p>I recommend that you use my repositories, which are as follows:</p><ul><li><code>Matthewbdaly\LaravelComments\Contracts\Repositories\Comment</code></li><li><code>Matthewbdaly\LaravelComments\Contracts\Repositories\Comment\Flag</code></li></ul><p>These use <code>matthewbdaly/laravel-repositories</code> and so implement caching on the decorated repository, making it simple to ensure your models get cached appropriately. However, they aren’t compulsory.</p><h2 id="events">Events</h2><p>You can set up listeners for the following events:</p><ul><li><code>Matthewbdaly\LaravelComments\Events\CommentReceived</code></li></ul><p>Fired when a new comment is submitted. The package does not include any kind of validation of comments, so you can instead listen for this event and implement your own functionality to validate them (eg, check it with Akismet, check for links). That way you can easily customise how it handles potentially spammy comments for your own particular use case.</p><ul><li><code>Matthewbdaly\LaravelComments\Events\CommentFlagged</code></li></ul><p>This event indicates that a comment has been flagged for moderator attention. You can use this event to send whatever notification is most appropriate (eg, email, Slack, SMS).</p></article><article class="post"><p class="date">7th January 2018 4:32 pm</p><h1><a href="/blog/2018/01/07/more-tricks-for-speeding-up-your-laravel-test-suite/">More Tricks for Speeding Up Your Laravel Test Suite</a></h1><p>When you first start doing test-driven development with Laravel, it can be quite hard to produce a test suite that runs quickly enough. The first time I used Laravel for a large project, I had a test suite that at one time, took over seven minutes to run, which was pretty awful considering that the ideal time for a test suite to take to run is no more than ten seconds.</p><p>Fortunately, with experience you can pick up some techniques which can quite drastically speed up your test suite. Here are some of the ones I’ve learned that can be useful.</p><p>Note that some of these are contradictory, and what works for one use case won’t necessarily work for another, so my advice is to try these and see what makes a difference for your use case.</p><h2 id="reduce-the-cost-of-hashing">Reduce the cost of hashing</h2><p>Inside the <code>createApplication()</code> method of <code>tests\CreatesApplication.php</code>, place the following statement:</p><pre><code class="hljs lang-php singleline">        Hash::setRounds(<span class="hljs-number">4</span>);</code></pre><p>This makes hashing passwords quicker and less demanding, and since you don’t care about the security of a password in a test, you’re not losing out in any way by doing so.</p><p>This, by itself, can <em>massively</em> reduce the time taken by your test suite - your mileage may vary, but I’ve personally seen it cut to a third of the previous time by using this. In fact, it’s recently been added to Laravel by default.</p><h2 id="if-you-re-creating-a-lot-of-fixtures-for-tests-do-so-in-a-transaction">If you’re creating a lot of fixtures for tests, do so in a transaction</h2><p>Sometimes, your application requires a lot of data to be added to the database just to be usable, and it’s quite common to use seeders for this purpose. However, it can take some time to insert a lot of data, especially if it has to be re-run for every test. If you do have to insert a lot of data before a test, you can cut down the time substantially by wrapping the seeder calls in a transaction:</p><pre><code class="hljs lang-php"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-meta">&lt;?php</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Database</span>\<span class="hljs-title">Seeder</span>;</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Database</span>\<span class="hljs-title">Eloquent</span>\<span class="hljs-title">Model</span>;</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td><span class="hljs-keyword">use</span> <span class="hljs-title">DB</span>;</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DatabaseSeeder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Seeder</span></span></td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>{</td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>    <span class="hljs-comment">/**</span></td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>     * Run the database seeds.</td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>     *</td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>     * <span class="hljs-doctag">@return</span> void</td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>     */</td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span></td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td>    {</td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td>        Model::unguard();</td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td>        DB::beginTransaction();</td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td>        <span class="hljs-keyword">$this</span>-&gt;call(GroupTableSeeder::class);</td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td>        <span class="hljs-keyword">$this</span>-&gt;call(UserTableSeeder::class);</td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td>        <span class="hljs-keyword">$this</span>-&gt;call(ProjectTableSeeder::class);</td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td>        DB::commit();</td></tr><tr><td class="linenos" data-pseudo-content="23"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="24"></td><td>        Model::reguard();</td></tr><tr><td class="linenos" data-pseudo-content="25"></td><td>    }</td></tr><tr><td class="linenos" data-pseudo-content="26"></td><td>}</td></tr><tr><td class="linenos" data-pseudo-content="27"></td><td>`</td></tr></table></code></pre><p>I’ve personally seen this trick cut the insert time by over half, every single time the database is seeded. If you don’t have much data to insert, it may not help, but for large amounts of data it can make a big difference.</p><h2 id="if-a-lot-of-tests-need-the-same-data-migrate-and-seed-it-first-then-wrap-the-tests-in-transactions-and-roll-them-back-afterwards">If a lot of tests need the same data, migrate and seed it first, then wrap the tests in transactions and roll them back afterwards</h2><p>If multiple tests need to work with the same dataset, you should consider running the migrations and seeders before the first test, and then wrapping each test inside a transaction. That way the data will only be inserted once, and will be rolled back to that initial good state after each test.</p><pre><code class="hljs lang-php"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> $migrated = <span class="hljs-keyword">false</span>;</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span></span></td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>    {</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>        <span class="hljs-keyword">parent</span>::setUp();</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>        DB::beginTransaction();</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>    }</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tearDown</span><span class="hljs-params">()</span></span></td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>    {</td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>        DB::rollback();</td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>        <span class="hljs-keyword">parent</span>::tearDown();</td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>    }</td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setUpBeforeClass</span><span class="hljs-params">()</span></span></td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td>    {</td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">self</span>::$migrated) {</td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td>            Artisan::call(<span class="hljs-string">'migrate:fresh'</span>);</td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td>            Artisan::call(<span class="hljs-string">'db:seed'</span>);</td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td>            <span class="hljs-keyword">self</span>::$migrated = <span class="hljs-keyword">true</span>;</td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td>        }</td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td>    }</td></tr></table></code></pre><p>Using something like this instead of one of the existing testing traits may be a better fit under those circumstances. However, if your application uses transactions for some functionality this might cause problems.</p><h2 id="don-t-create-a-full-instance-of-the-laravel-application-unless-you-have-to">Don’t create a full instance of the Laravel application unless you have to</h2><p>Not every test requires that you instantiate the full Laravel application, and doing so slows your tests down. If you don’t absolutely need the full application instantiated in the test, consider having your test inherit from the below simple test case class instead:</p><pre><code class="hljs lang-php"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-meta">&lt;?php</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-keyword">namespace</span> <span class="hljs-title">Tests</span>;</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td><span class="hljs-keyword">use</span> <span class="hljs-title">Mockery</span>\<span class="hljs-title">Adapter</span>\<span class="hljs-title">Phpunit</span>\<span class="hljs-title">MockeryPHPUnitIntegration</span>;</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td><span class="hljs-keyword">use</span> <span class="hljs-title">PHPUnit</span>\<span class="hljs-title">Framework</span>\<span class="hljs-title">TestCase</span> <span class="hljs-title">as</span> <span class="hljs-title">BaseTestCase</span>;</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleTestCase</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseTestCase</span></span></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>{</td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>    <span class="hljs-keyword">use</span> <span class="hljs-title">MockeryPHPUnitIntegration</span>;</td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>}</td></tr></table></code></pre><p>For properly isolated unit tests, using this base class instead can have a noticeable effect on performance.</p><h2 id="if-you-can-use-an-in-memory-sqlite-database-for-testing">If you can, use an in-memory SQLite database for testing</h2><p>This isn’t an option if you’re relying on the features of another database, but if it is, this is usually the fastest way to go. Configure it as follows in <code>phpunit.xml</code>:</p><pre><code class="hljs lang-xml"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>        <span class="hljs-tag">&lt;<span class="hljs-name">env</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"DB_CONNECTION"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"sqlite"</span>/&gt;</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>        <span class="hljs-tag">&lt;<span class="hljs-name">env</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"DB_DATABASE"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">":memory:"</span>/&gt;</span></td></tr></table></code></pre><h2 id="use-the-new-refresh-database-trait">Use the new Refresh Database trait</h2><pre><code class="hljs lang-php singleline">   <span class="hljs-keyword">use</span> <span class="hljs-title">RefreshDatabase</span>;</code></pre><p>This testing trait is generally more efficient than migrating down and up, because it empties the database afterwards rather than stepping through the changes of each migration. If you have a non-trivial number of migrations, it will almost certainly be quicker than migrating down, then back up for the next test.</p><h2 id="mock-what-you-can-t-control">Mock what you can’t control</h2><p>You should never, ever be making calls to external APIs in your test suite, because you can’t control whether those external API’s work - if a third-party API goes down, you may get a failed test run even if your application is working perfectly, not to mention it will add the time taken to send the request and receive a response to the test time. Instead, mock the calls to the third-party API.</p><h2 id="for-large-applications-consider-moving-parts-into-a-separate-package">For large applications, consider moving parts into a separate package</h2><p>If you have a particularly large application, it’s worth considering moving parts of it out into standalone packages and requiring them using Composer’s support for private Git repositories. That way, those packages can have their own test suites, and the main application’s test suite can cover the remaining functionality.</p><p>For instance, it’s fairly straightforward to pull out your models and migrations and put them in a separate package, and the tests for them can go with them to that package.</p><p>You should also consider whether parts of your application would be useful as standalone packages, and if so pull them out along with their tests. That way, not only are you making your test suite quicker, but you’re also saving yourself work by creating a reusable solution for a problem you might encounter again in the future.</p><h2 id="turn-off-xdebug">Turn off XDebug</h2><p>XDebug has a horrendous effect on the performance of the test suite. Turn it off unless you need it to generate test coverage. Better yet, set up continuous integration and have that generate the coverage for you.</p><h2 id="summary">Summary</h2><p>When you first start using Laravel, it can be hard to keep your test suite lean, and the longer a test suite takes to run, the less likely it is to actually get run regularly. To practice TDD properly, your test suite should not take long enough that your mind starts to wander, and ten seconds is a good target to aim for in this regard - you need to be able to run it several times a minute without problem. Obviously things like having a faster computer or an SSD will help, but there’s a lot you can do to make your test suite more efficient, even when running on a quite basic machine.</p></article><article class="post"><p class="date">3rd January 2018 11:49 am</p><h1><a href="/blog/2018/01/03/adding-dynamic-flat-pages-to-your-laravel-app/">Adding Dynamic Flat Pages to Your Laravel App</a></h1><p>Most web apps have at least some need for some additional flat pages, for purposes such as:</p><ul><li>Terms and conditions</li><li>Cookie/privacy policy</li><li>FAQ</li></ul><p>You can of course hard-code this content in a view file, but if this content is likely to change often it may be useful to give the site owners the capability to manage this themselves.</p><p><a href="https://github.com/matthewbdaly/laravel-flatpages">Laravel Flatpages</a> is a package I wrote that adds a flatpage model, controller and view to your application. It’s loosely inspired by Django’s flatpages app. Using it, you can quickly and easily build a very simple brochure-style CMS. Each page contains fields for the title, content, slug, and an optional template field that specifies which view to use.</p><p>Note that it doesn’t include any kind of admin functionality, so you’ll need to add this yourself or find a package for it. It uses my <a href="http://github.com/matthewbdaly/laravel-repositories">repositories package</a> to access the database, and this has caching built in, so when you create, update or delete a flatpage, you should either resolve <code>Matthewbdaly\LaravelFlatpages\Contracts\Repositories\Flatpage</code> and use the methods on that to make the changes (in which case the appropriate caches should be flushed automatically), or flush the cache. It also requires a cache backend that supports tags, such as Memcached or Redis.</p><p>It does not include routing in the package itself because I couldn’t find a way to guarantee that it would always be the last route, so instead you should put this in your <code>routes/web.php</code> and make sure it’s always the last route:</p><pre><code class="hljs lang-php singleline">Route::get(<span class="hljs-string">'{path}'</span>, <span class="hljs-string">'\Matthewbdaly\LaravelFlatpages\Http\Controllers\FlatpageController@page'</span>);</code></pre><p>Otherwise you could wind up with problems. The reason for that is that it has to check the path against the slugs of the flat pages in the database, and if it doesn’t find any it raises a 404.</p><p>Or, if you prefer, you can use the middleware at <code>Matthewbdaly\LaravelFlatpages\Http\Middleware\FlatpageMiddleware</code>, which may be more convenient in many case. This should be added as the last global middleware in <code>app\Http\Kernel.php</code>.</p></article><article class="post"><p class="date">2nd January 2018 12:12 pm</p><h1><a href="/blog/2018/01/02/a-laravel-package-boilerplate/">A Laravel Package Boilerplate</a></h1><p>The second package I’ve been working on recently is <a href="https://github.com/matthewbdaly/laravel-package-boilerplate">Laravel Package Boilerplate</a>. It’s a basic starter boilerplate for building your own Laravel packages.</p><p>It’s not meant to be installed as a project dependency. Instead, run the following command to create a new project boilerplate with it:</p><pre><code class="hljs lang-bash singleline">composer create-project --prefer-dist matthewbdaly/laravel-package-boilerplate &lt;YOUR_NEW_PACKAGE_DIRECTORY&gt;</code></pre><p>This will create a new folder that includes a <code>src</code> folder containing a service provider, and a <code>tests</code> folder containing a preconfigured base test case, as well as a simple test case for tests that don’t need the full application instantiated, in order to help keep your test suite as fast as possible.</p><p>In addition, it includes configuration files for:</p><ul><li>PHPUnit</li><li>PHP CodeSniffer</li><li>Travis CI</li></ul><p>That way you can start your project off the right way with very little effort.</p><p>I’ve also added my Artisan Standalone project as a dependency - that way you can access any Artisan commands you need to generate files you need as follows:</p><pre><code class="hljs lang-bash singleline">$ vendor/bin/artisan</code></pre><p>Hopefully this package should make it a lot easier to create new Laravel packages in future.</p></article></div><div class="col-md-4"><h1>Recent Posts</h1><p><a href="/blog/2019/09/07/setting-private-properties-in-tests/">Setting Private Properties in Tests</a></p><p><a href="/blog/2019/07/28/skipping-environment-specific-phpunit-tests/">Skipping Environment Specific Phpunit Tests</a></p><p><a href="/blog/2019/06/19/powering-up-git-bisect-with-the-run-command/">Powering Up Git Bisect With the Run Command</a></p><p><a href="/blog/2019/05/14/writing-golden-master-tests-for-laravel-applications/">Writing Golden Master Tests for Laravel Applications</a></p><p><a href="/blog/2019/03/04/how-much-difference-does-adding-an-index-to-a-database-table-make/">How Much Difference Does Adding An Index to a Database Table Make?</a></p><section><h2>About me</h2><p>I'm a web and mobile app developer based in Norfolk. My skillset includes Python, PHP and Javascript, and I have extensive experience working with CodeIgniter, Laravel, Zend Framework, Django, Phonegap and React.js.</p></section><section id="links"><h2>Links</h2><a href="https://github.com/matthewbdaly" rel="me">GitHub</a> <a href="https://twitter.com/MattBD" rel="me">Twitter</a> <a href="http://stackoverflow.com/users/63717/matthew-daly">Stack Overflow</a></section></div></div><div class="row"><div class="col-md-12"><ul class="pagination"><li class="page-item"><a href="/posts/9/">Newer</a></li><li class="page-item"><a href="/posts/11/">Older</a></li></ul></div></div></div><footer><div class="container footercontainer"><div class="col-md-12"><p class="copyright">Copyright &copy; Matthew Daly 2019.</p></div></div></footer><script type="text/javascript" src="/static/js/all.min.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-17043630-1');ga('send','pageview');</script><script id="dsq-count-scr" src="//matthewdaly.disqus.com/count.js" async></script></body></html>